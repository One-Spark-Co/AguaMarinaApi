<script>
const customerId = LS.customer;
console.log('customerId', customerId);

if (customerId != null && (window.location.pathname === "/account" || window.location.pathname === "/account/")){
    const endpoint = `https://ff8xt2bfj7.execute-api.us-east-1.amazonaws.com/get-user-liters?userId=${customerId}`;
    
   const options = {
    method: "GET",
    headers: {
      "Content-Type": "application/json"
    }
   };

  // Find the target section to insert after - page-header section
  const targetSection = document.querySelector('section.page-header');
  
  if (targetSection) {
    // Create the balance component
    const balanceDiv = document.createElement('div');
    balanceDiv.style.display = 'flex';
    balanceDiv.style.flexDirection = 'column';
    balanceDiv.style.alignItems = 'center';
    balanceDiv.style.marginBottom = '45px';
    balanceDiv.style.marginTop = '30px';
    balanceDiv.style.padding = '20px';
    balanceDiv.style.backgroundColor = 'transparent';

    balanceDiv.innerHTML = `
      <h2 style="font-weight: bold; margin: 0 0 30px 0;">BALANCE</h2>
      <p style="font-size: 3rem; font-weight: bold; margin: 0 0 30px 0;">-</p>
      <p style="font-size: 0.8rem;">Litros disponibles</p>
    `;

    // Insert the balance component after the target section
    targetSection.parentNode.insertBefore(balanceDiv, targetSection.nextSibling);

    // Fetch and update the liters data
    fetch(endpoint, options)
      .then(response => {
        if (!response.ok) {
          throw new Error(`HTTP error! status: ${response.status}`);
        }
        return response.json();
      })
      .then(data => {
        console.log("[NAVA] data", data);
        balanceDiv.innerHTML = `
          <h2 style="font-weight: bold; margin: 0 0 30px 0;">BALANCE</h2>
          <p style="font-size: 3rem; font-weight: bold; margin: 0 0 30px 0;">${data?.liters || 0}</p>
          <p style="font-size: 0.8rem;">Litros disponibles</p>
        `;
      })
      .catch(error => {
        console.error('Error fetching liters:', error);
        balanceDiv.innerHTML = `
          <h2 style="font-weight: bold; margin: 0 0 30px 0;">BALANCE</h2>
          <p style="font-size: 3rem; font-weight: bold; margin: 0 0 30px 0;">Error</p>
          <p style="font-size: 0.8rem;">No se pudo cargar</p>
        `;
      });
  } else {
    console.warn('Target section not found: section.page-header');
  }
}
</script>